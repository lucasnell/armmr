

# library(testthat)
# library(armmr)


test_that("hpdi produces accurate output",
{

    set.seed(23)
    z <- lapply(as.integer(runif(100, 100, 500)), function(.n) runif(.n))
    pr <- runif(100)

    known <- cbind(
        lower = c(0.00779736903496087, 0.0288408997002989, 0.896908330963925,
                  0.368620650609955, 0.664307503262535, 0.328557855216786,
                  0.358475663466379, 0.017627558670938, 0.00377070531249046,
                  0.189672214444727, 0.352556270547211, 0.360058538848534,
                  0.0270577231422067, 0.0773998333606869, 0.7416501569096,
                  0.0155982112046331, 0.750380411511287, 0.44231469463557,
                  0.0362450683023781, 0.0507412499282509, 0.137571512721479,
                  0.669373828917742, 0.0626567206345499, 0.540274754865095,
                  0.55220658518374, 0.664101608330384, 0.0851410974282771,
                  0.277446381282061, 0.0840135512407869, 0.10685350233689,
                  0.28273477894254, 0.86995339486748, 0.0983592430129647,
                  0.469926208024845, 0.686949147609994, 0.261212946614251,
                  0.103414862416685, 0.0371618871577084, 0.0203659376129508,
                  0.216457686154172, 0.198341351933777, 0.00626486190594733,
                  0.374691647477448, 0.0783657182473689, 0.0499928840436041,
                  0.222463638754562, 0.449973080540076, 0.105839113937691,
                  0.106176258064806, 0.189341653836891, 0.348093547392637,
                  0.0959834139794111, 0.00739886541850865, 0.0109452030155808,
                  0.012049971614033, 0.0747028004843742, 0.00636173621751368,
                  0.0897199749015272, 0.104114843998104, 0.214615954784676,
                  0.0992659798357636, 0.396077927667648, 0.0377507084049284,
                  0.00269173458218575, 0.0351823316887021, 0.740815669531003,
                  0.309332032920793, 0.000473315129056573, 0.0700535767246038,
                  0.816422341857105, 0.227333734510466, 0.683778482722118,
                  0.432232590625063, 0.532540905755013, 0.907457964727655,
                  0.598212315700948, 0.0973809727001935, 0.000642291037365794,
                  0.521781385410577, 0.651543749962002, 0.358837915817276,
                  0.0163318999111652, 0.138538776664063, 0.0608054825570434,
                  0.066708927275613, 0.0905925061088055, 0.125521242618561,
                  0.84652672894299, 0.641932633239776, 0.063151044305414,
                  0.010192007990554, 0.123811532743275, 0.386480582645163,
                  0.168308899272233, 0.4921020984184, 0.191756945336238,
                  0.574972549919039, 0.31662013544701, 0.4132643584162,
                  0.309575238963589),

        upper = c(0.910197394434363, 0.709931076737121, 0.947036641184241,
                  0.906641875393689, 0.753475604811683, 0.769276855513453,
                  0.910979698644951, 0.189783930312842, 0.936182757141069,
                  0.552055364008993, 0.728203383740038, 0.678647717228159,
                  0.922047184547409, 0.858614295721054, 0.923349436605349,
                  0.202384367585182, 0.980033015832305, 0.474941907683387,
                  0.862119443714619, 0.958615403855219, 0.173343642149121,
                  0.797852924792096, 0.958010418573394, 0.753164975671098,
                  0.821810311870649, 0.903197364648804, 0.518085351679474,
                  0.807144557125866, 0.620867153862491, 0.426505680894479,
                  0.466849635588005, 0.926200062967837, 0.983737770235166,
                  0.99733600881882, 0.827074562199414, 0.547013679519296,
                  0.725231735035777, 0.909895861288533, 0.426708581158891,
                  0.219957093941048, 0.560255697462708, 0.688460458768532,
                  0.465741904685274, 0.943134458735585, 0.745156284887344,
                  0.360234929714352, 0.61606420413591, 0.128890483174473,
                  0.913179702591151, 0.544681196566671, 0.34968023491092,
                  0.993844682350755, 0.596858541946858, 0.958878405625001,
                  0.874485406791791, 0.852542500710115, 0.592008348554373,
                  0.614655178971589, 0.188510955311358, 0.958289864473045,
                  0.413133084308356, 0.732734124641865, 0.762244867859408,
                  0.321858470095322, 0.826119689736515, 0.75805891235359,
                  0.874056371860206, 0.962917191674933, 0.996427806094289,
                  0.835299573373049, 0.947023577056825, 0.734095631632954,
                  0.998896877514198, 0.940945939160883, 0.933671082137153,
                  0.647109189303592, 0.913600771687925, 0.999983065528795,
                  0.723613791167736, 0.708604474551976, 0.954035494010895,
                  0.995265582809225, 0.620498446281999, 0.140415465226397,
                  0.690375160891563, 0.975211892509833, 0.35712916799821,
                  0.895296514732763, 0.826715764123946, 0.474224042380229,
                  0.850534015800804, 0.417171754874289, 0.89748054696247,
                  0.924987788079306, 0.830813646083698, 0.644153909059241,
                  0.595423308899626, 0.818093839799985, 0.998573371674865,
                  0.463561181910336),
        prob = c(0.93030303030303, 0.724867724867725, 0.0905172413793103,
                 0.5625, 0.126463700234192, 0.49814126394052, 0.569072164948454,
                 0.207739307535642, 0.926605504587156, 0.411646586345382,
                 0.408071748878924, 0.368421052631579, 0.9296875,
                 0.831111111111111, 0.205479452054795, 0.232258064516129,
                 0.276872964169381, 0.056379821958457, 0.834033613445378,
                 0.917378917378917, 0.0598802395209581, 0.172248803827751,
                 0.911949685534591, 0.283333333333333, 0.326771653543307,
                 0.299065420560748, 0.477211796246649, 0.56953642384106,
                 0.555555555555556, 0.347931873479319, 0.227011494252874,
                 0.0956937799043062, 0.9, 0.585774058577406, 0.181818181818182,
                 0.32387706855792, 0.650717703349282, 0.892631578947368,
                 0.439130434782609, 0.0235294117647059, 0.420047732696897,
                 0.744360902255639, 0.135514018691589, 0.881868131868132,
                 0.702179176755448, 0.192682926829268, 0.243243243243243,
                 0.0564516129032258, 0.840182648401826, 0.396508728179551,
                 0.0133779264214047, 0.899297423887588, 0.624434389140271,
                 .955710955710956, 0.859956236323851, 0.878504672897196,
                 0.592039800995025, 0.589583333333333, 0.125766871165644,
                 0.782135076252723, 0.347222222222222, 0.403846153846154,
                 0.752380952380952, 0.363265306122449, 0.833333333333333,
                 0.0505836575875486, 0.584507042253521, 0.968814968814969,
                 0.932584269662921, 0.0383064516129032, 0.765243902439024,
                 0.101694915254237, 0.587852494577007, 0.458745874587459,
                 0.0740740740740741, 0.0918367346938776, 0.853080568720379,
                 0.994708994708995, 0.267857142857143, 0.0870488322717622,
                 0.627272727272727, 0.985714285714286, 0.535637149028078,
                 0.108045977011494, 0.649651972157773, 0.935714285714286,
                 0.286585365853659, 0.0735294117647059, 0.305555555555556,
                 0.470588235294118, 0.875, 0.36, 0.56687898089172,
                 0.767584097859327, 0.405405405405405, 0.530172413793103,
                 0.0396825396825397, 0.578778135048232, 0.650190114068441,
                 0.196078431372549))

    obs <- cbind(lower = numeric(100), upper = numeric(100),
                 prob = numeric(100))


    for (i in 1:100) {
        obs_i <- armmr:::hpdi(z[[i]], pr[i])
        for (n in c("lower", "upper")) obs[i, n] <- obs_i[[n]]
        obs[i,"prob"] <- attr(obs_i, "Probability")
    }
    expect_equal(known, obs)

})




